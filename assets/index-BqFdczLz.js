var oe=n=>{throw TypeError(n)};var K=(n,e,t)=>e.has(n)||oe("Cannot "+t);var i=(n,e,t)=>(K(n,e,"read from private field"),t?t.call(n):e.get(n)),c=(n,e,t)=>e.has(n)?oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),l=(n,e,t,r)=>(K(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),x=(n,e,t)=>(K(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const P={BASE_URL:"https://story-api.dicoding.dev/v1",VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"},H={GET_ALL_STORIES:`${P.BASE_URL}/stories?location=1`,LOGIN:`${P.BASE_URL}/login`,REGISTER:`${P.BASE_URL}/register`,SUBSCRIBE:`${P.BASE_URL}/notifications/subscribe`};async function he(n){return(await(await fetch(H.GET_ALL_STORIES,{headers:{Authorization:`Bearer ${n}`}})).json()).listStory}async function ge(n,e){const r=await(await fetch(H.LOGIN,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e})})).json();if(r.error)throw new Error(r.message);return r}async function pe(n,e,t){const o=await(await fetch(H.REGISTER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:e,password:t})})).json();if(o.error)throw new Error(o.message);return o}async function ye(n,e){const t=await fetch(`${P.BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:e}),r=await t.json();if(!t.ok)throw new Error(r.message||"Gagal mengirim cerita.");return r}async function fe({endpoint:n,keys:e},t){const r=await fetch(H.SUBSCRIBE,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({endpoint:n,keys:e})}),o=await r.json();if(!r.ok)throw new Error(o.message||"Gagal berlangganan notifikasi");return o}async function we({endpoint:n},e){const t=await fetch(H.SUBSCRIBE,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({endpoint:n})}),r=await t.json();if(!t.ok)throw new Error(r.message||"Gagal berhenti langganan notifikasi");return r}const Pe=Object.freeze(Object.defineProperty({__proto__:null,addNewStory:ye,getAllStories:he,loginUser:ge,registerUser:pe,subscribePushNotification:fe,unsubscribePushNotification:we},Symbol.toStringTag,{value:"Module"}));var v,_;class Te{constructor({view:e,token:t}){c(this,v);c(this,_);l(this,v,e),l(this,_,t)}async showStories(){try{const e=await he(i(this,_));if(!e||!Array.isArray(e)||e.length===0){i(this,v).showEmptyState();return}i(this,v).showStoriesOnList(e),i(this,v).showStoriesOnMap(e)}catch(e){console.error("Gagal mengambil cerita:",e),i(this,v).showErrorState()}}}v=new WeakMap,_=new WeakMap;var $;class De{constructor(){c(this,$)}async render(){return`
      <section class="container">
        <h1>Beranda Cerita</h1>
        <div id="story-list" class="story-list">Memuat cerita...</div>

        <h2 style="margin-top: 40px;">Peta Cerita</h2>
        <div id="map" style="height: 400px; margin-top: 16px; border-radius: 8px;"></div>
      </section>
    `}async afterRender(){const e=localStorage.getItem("authToken");if(!e){const t=document.querySelector("#story-list");t.innerHTML='<p>Anda belum login. Silakan <a href="#/login">login</a> terlebih dahulu.</p>';return}l(this,$,new Te({view:this,token:e})),await i(this,$).showStories()}showStoriesOnList(e){const t=document.querySelector("#story-list");t.innerHTML=e.map(r=>`
      <a href="#/detail/${r.id}" class="story-item" style="text-decoration: none; color: inherit;">
        <img src="${r.photoUrl}" alt="Foto cerita oleh ${r.name}" class="story-image" />
        <h2>${r.name}</h2>
        <p>${r.description}</p>
        <small>Dibuat pada: ${new Date(r.createdAt).toLocaleDateString()}</small>
      </a>
    `).join("")}showStoriesOnMap(e){const t=document.getElementById("map");t._leaflet_id&&(t._leaflet_id=null,t.innerHTML="");const r=L.map("map").setView([-2.5489,118.0149],4);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(r),e.forEach(o=>{o.lat&&o.lon&&L.marker([o.lat,o.lon]).addTo(r).bindPopup(`<strong>${o.name}</strong><br>${o.description}`)})}showEmptyState(){const e=document.querySelector("#story-list");e.innerHTML="<p>Tidak ada cerita ditemukan.</p>"}showErrorState(){const e=document.querySelector("#story-list");e.innerHTML="<p>Gagal memuat cerita. Silakan coba lagi nanti.</p>"}}$=new WeakMap;class Ce{async render(){return`
      <section class="container">
        <h1>About Page</h1>
      </section>
    `}async afterRender(){}}var D;class Me{constructor(e){c(this,D);l(this,D,e)}async login(e,t){try{const r=await ge(e,t);i(this,D).onLoginSuccess(r)}catch(r){i(this,D).onLoginError(r.message)}}}D=new WeakMap;var j;class Ae{constructor(){c(this,j)}async render(){return`
      <section class="container">
        <h1>Login</h1>
        <form id="login-form">
          <label for="email">Email</label>
          <input type="email" id="email" required />

          <label for="password">Password</label>
          <input type="password" id="password" required minlength="8" />

          <button type="submit">Masuk</button>
        </form>
        <div id="login-message"></div>
        <p style="margin-top: 10px;">Belum punya akun? <a href="#/register">Daftar di sini</a>.</p>
      </section>
    `}async afterRender(){l(this,j,new Me(this));const e=document.querySelector("#login-form");e.addEventListener("submit",t=>{t.preventDefault();const r=e.email.value,o=e.password.value;i(this,j).login(r,o)})}onLoginSuccess(e){localStorage.setItem("authToken",e.loginResult.token),document.getElementById("login-message").textContent="Login berhasil!",setTimeout(()=>{window.updateNav(),location.hash="#/"},1e3)}onLoginError(e){document.getElementById("login-message").textContent="Login gagal: "+e}}j=new WeakMap;var m,N,C,g,M,B,be,Q;class Oe{constructor({view:e,token:t}){c(this,B);c(this,m);c(this,N);c(this,C,null);c(this,g,null);c(this,M,null);l(this,m,e),l(this,N,t)}async initialize(){x(this,B,be).call(this),await x(this,B,Q).call(this)}capturePhoto(){const{canvas:e,ctx:t}=i(this,m).getCanvasContext(),r=document.getElementById("camera-video");e.width=r.videoWidth,e.height=r.videoHeight,t.drawImage(r,0,0),e.toBlob(o=>{if(!o){i(this,m).showMessage("Gagal menangkap gambar.","error");return}l(this,C,o);const a=URL.createObjectURL(o);i(this,m).showCapturedImage(a),i(this,g)&&i(this,g).getTracks().forEach(s=>s.stop())},"image/jpeg")}async submitForm(e,t,r){if(!i(this,C)||!e){i(this,m).showMessage("Foto dan deskripsi wajib diisi.","error");return}const o=new File([i(this,C)],"snapshot.jpg",{type:"image/jpeg"}),a=new FormData;a.append("description",e),a.append("photo",o),t&&r&&(a.append("lat",t),a.append("lon",r));try{const s=await ye(i(this,N),a);i(this,m).showMessage(s.message||"Cerita berhasil dikirim!"),i(this,m).resetFormUI(),setTimeout(()=>{location.hash="#/"},1e3)}catch(s){console.error(s),i(this,m).showMessage(s.message||"Gagal mengirim cerita.","error")}}async restartCamera(){i(this,g)&&i(this,g).getTracks().forEach(e=>e.stop()),await x(this,B,Q).call(this)}destroy(){i(this,g)&&(i(this,g).getTracks().forEach(e=>e.stop()),l(this,g,null))}}m=new WeakMap,N=new WeakMap,C=new WeakMap,g=new WeakMap,M=new WeakMap,B=new WeakSet,be=function(){const e=L.map(i(this,m).getMapContainer()).setView([-2.5,118],4);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(e);const t=L.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]});e.on("click",r=>{const{lat:o,lng:a}=r.latlng;i(this,m).setLatLon(o,a),i(this,M)&&i(this,M).remove(),l(this,M,L.marker([o,a],{icon:t}).addTo(e).bindPopup(`<strong>Lokasi dipilih:</strong><br>${o.toFixed(5)}, ${a.toFixed(5)}`).openPopup())})},Q=async function(){try{l(this,g,await navigator.mediaDevices.getUserMedia({video:!0})),i(this,m).setVideoStream(i(this,g))}catch(e){console.error("Tidak dapat mengakses kamera:",e),i(this,m).showMessage("Tidak dapat mengakses kamera.","error")}};var p;class Re{constructor(){c(this,p)}async render(){return`
      <section class="container">
        <h1>Tambah Cerita Baru</h1>
  
        <form id="add-story-form">
          <label for="description">Deskripsi</label>
          <textarea id="description" rows="4" required></textarea>
  
          <label>Ambil Foto dari Kamera</label>
          <video id="camera-video" autoplay playsinline style="width: 100%; max-width: 400px; border-radius: 8px;"></video>
          <p style="font-size: 0.9rem; color: #555; margin-top: 6px;">Cukup 1 klik untuk ambil foto.</p>
          <button type="button" id="capture-btn">Ambil Foto</button>
          <button type="button" id="retake-btn">Ambil Ulang Foto</button>
          
          <canvas id="snapshot-canvas" style="display: none;"></canvas>
          <img id="preview-image" style="display: none; width: 100%; margin-top: 1rem; border-radius: 8px;" />
  
          <label>Lokasi</label>
          <div id="map" style="height: 300px; margin-bottom: 1rem;"></div>
          <input type="hidden" id="lat" />
          <input type="hidden" id="lon" />
  
          <button type="submit">Kirim Cerita</button>
        </form>
  
        <div id="submit-message"></div>
      </section>
    `}async afterRender(){const e=localStorage.getItem("authToken");if(!e){const t=document.querySelector(".container");t.innerHTML='<p>Anda belum login. Silakan <a href="#/login">login</a> terlebih dahulu.</p>';return}l(this,p,new Oe({view:this,token:e})),await i(this,p).initialize(),document.getElementById("capture-btn").addEventListener("click",()=>i(this,p).capturePhoto()),document.getElementById("retake-btn").addEventListener("click",()=>i(this,p).restartCamera()),document.getElementById("add-story-form").addEventListener("submit",t=>{t.preventDefault();const r=document.getElementById("description").value,o=document.getElementById("lat").value,a=document.getElementById("lon").value;i(this,p).submitForm(r,o,a)})}unmount(){var e;(e=i(this,p))!=null&&e.destroy&&i(this,p).destroy()}setVideoStream(e){const t=document.getElementById("camera-video");t.srcObject=e}showCapturedImage(e){const t=document.getElementById("preview-image");t.src=e,t.style.display="block"}getCanvasContext(){const e=document.getElementById("snapshot-canvas"),t=e.getContext("2d");return{canvas:e,ctx:t}}resetFormUI(){const e=document.getElementById("add-story-form"),t=document.getElementById("preview-image");e.reset(),t.src="",t.style.display="none",document.getElementById("lat").value="",document.getElementById("lon").value=""}showMessage(e,t="success"){const r=document.getElementById("submit-message");r.style.color=t==="success"?"green":"red",r.textContent=e}setLatLon(e,t){document.getElementById("lat").value=e,document.getElementById("lon").value=t}getMapContainer(){return document.getElementById("map")}}p=new WeakMap;var A;class xe{constructor(e){c(this,A);l(this,A,e)}async register(e,t,r){try{await pe(e,t,r),i(this,A).onRegisterSuccess()}catch(o){i(this,A).onRegisterError(o.message)}}}A=new WeakMap;var U;class _e{constructor(){c(this,U)}async render(){return`
      <section class="container">
        <h1>Register</h1>
        <form id="register-form">
          <label for="name">Nama</label>
          <input type="text" id="name" required />

          <label for="email">Email</label>
          <input type="email" id="email" required />

          <label for="password">Password</label>
          <input type="password" id="password" required minlength="8" />

          <button type="submit">Daftar</button>
        </form>
        <div id="register-message"></div>
      </section>
    `}async afterRender(){l(this,U,new xe(this));const e=document.querySelector("#register-form");e.addEventListener("submit",t=>{t.preventDefault();const r=e.name.value,o=e.email.value,a=e.password.value;i(this,U).register(r,o,a)})}onRegisterSuccess(){const e=document.getElementById("register-message");e.style.color="green",e.textContent="Registrasi berhasil! Silakan login.",location.hash="#/login"}onRegisterError(e){const t=document.getElementById("register-message");t.style.color="red",t.textContent="Gagal daftar: "+e}}U=new WeakMap;var S,y,G,E;class $e{constructor(e,{view:t,apiModel:r,dbModel:o}){c(this,S);c(this,y);c(this,G);c(this,E);l(this,S,e),l(this,y,t),l(this,G,r),l(this,E,o)}async init(){const e=localStorage.getItem("authToken");try{const t=await fetch(`https://story-api.dicoding.dev/v1/stories/${i(this,S)}`,{headers:{Authorization:`Bearer ${e}`}}),r=await t.json();t.ok?(i(this,y).showStoryDetail(r.story),await this.checkSavedStatus()):i(this,y).showError(r.message)}catch(t){console.error("Gagal mengambil detail:",t),i(this,y).showError("Terjadi kesalahan saat mengambil data.")}}async checkSavedStatus(){await i(this,E).getStoryById(i(this,S))?i(this,y).renderRemoveButton():i(this,y).renderSaveButton()}async saveStory(){try{const e=localStorage.getItem("authToken"),t=await fetch(`https://story-api.dicoding.dev/v1/stories/${i(this,S)}`,{headers:{Authorization:`Bearer ${e}`}}),r=await t.json();t.ok?(await i(this,E).putStory(r.story),console.log("Cerita berhasil disimpan!")):console.error("Gagal menyimpan:",r.message)}catch(e){console.error("saveStory error:",e)}}async removeStory(){try{await i(this,E).removeStory(i(this,S)),console.log("Cerita berhasil dihapus!")}catch(e){console.error("removeStory error:",e)}}}S=new WeakMap,y=new WeakMap,G=new WeakMap,E=new WeakMap;const X=(n,e)=>e.some(t=>n instanceof t);let ie,ae;function je(){return ie||(ie=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ne(){return ae||(ae=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Z=new WeakMap,J=new WeakMap,W=new WeakMap;function Ue(n){const e=new Promise((t,r)=>{const o=()=>{n.removeEventListener("success",a),n.removeEventListener("error",s)},a=()=>{t(I(n.result)),o()},s=()=>{r(n.error),o()};n.addEventListener("success",a),n.addEventListener("error",s)});return W.set(e,n),e}function qe(n){if(Z.has(n))return;const e=new Promise((t,r)=>{const o=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",s),n.removeEventListener("abort",s)},a=()=>{t(),o()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",a),n.addEventListener("error",s),n.addEventListener("abort",s)});Z.set(n,e)}let ee={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Z.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return I(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ve(n){ee=n(ee)}function Fe(n){return Ne().includes(n)?function(...e){return n.apply(te(this),e),I(this.request)}:function(...e){return I(n.apply(te(this),e))}}function He(n){return typeof n=="function"?Fe(n):(n instanceof IDBTransaction&&qe(n),X(n,je())?new Proxy(n,ee):n)}function I(n){if(n instanceof IDBRequest)return Ue(n);if(J.has(n))return J.get(n);const e=He(n);return e!==n&&(J.set(n,e),W.set(e,n)),e}const te=n=>W.get(n);function Ve(n,e,{blocked:t,upgrade:r,blocking:o,terminated:a}={}){const s=indexedDB.open(n,e),u=I(s);return r&&s.addEventListener("upgradeneeded",d=>{r(I(s.result),d.oldVersion,d.newVersion,I(s.transaction),d)}),t&&s.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{a&&d.addEventListener("close",()=>a()),o&&d.addEventListener("versionchange",h=>o(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const Ge=["get","getKey","getAll","getAllKeys","count"],ze=["put","add","delete","clear"],Y=new Map;function se(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Y.get(e))return Y.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,o=ze.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(o||Ge.includes(t)))return;const a=async function(s,...u){const d=this.transaction(s,o?"readwrite":"readonly");let h=d.store;return r&&(h=h.index(u.shift())),(await Promise.all([h[t](...u),o&&d.done]))[0]};return Y.set(e,a),a}ve(n=>({...n,get:(e,t,r)=>se(e,t)||n.get(e,t,r),has:(e,t)=>!!se(e,t)||n.has(e,t)}));const We=["continue","continuePrimaryKey","advance"],ce={},ne=new WeakMap,Se=new WeakMap,Ke={get(n,e){if(!We.includes(e))return n[e];let t=ce[e];return t||(t=ce[e]=function(...r){ne.set(this,Se.get(this)[e](...r))}),t}};async function*Je(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const t=new Proxy(e,Ke);for(Se.set(t,e),W.set(t,te(e));e;)yield t,e=await(ne.get(t)||e.continue()),ne.delete(t)}function le(n,e){return e===Symbol.asyncIterator&&X(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&X(n,[IDBIndex,IDBObjectStore])}ve(n=>({...n,get(e,t,r){return le(e,t)?Je:n.get(e,t,r)},has(e,t){return le(e,t)||n.has(e,t)}}));const Ye="story-app-db",Qe=1,T="stories",V=Ve(Ye,Qe,{upgrade(n){n.objectStoreNames.contains(T)||n.createObjectStore(T,{keyPath:"id"})}}),Ee={async putStory(n){if(!n.id)throw new Error("Cerita harus memiliki id");return(await V).put(T,n)},async getStoryById(n){return(await V).get(T,n)},async getAllStories(){return(await V).getAll(T)},async removeStory(n){return(await V).delete(T,n)}},Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));var q,f;class Ze{constructor(){c(this,q);c(this,f)}async render(){return`
      <section class="container">
        <div id="story-detail">Memuat cerita...</div>
        <div id="save-actions-container" style="margin-top: 16px;"></div>
      </section>
    `}async afterRender(){l(this,q,window.location.hash.split("/")[2]),l(this,f,new $e(i(this,q),{view:this,apiModel:Pe,dbModel:Ee})),await i(this,f).init()}showStoryDetail(e){const t=document.getElementById("story-detail");t.innerHTML=`
      <img src="${e.photoUrl}" alt="Foto oleh ${e.name}" style="width: 100%; border-radius: 8px;" />
      <h2>${e.name}</h2>
      <p>${e.description}</p>
      <small>Dibuat pada: ${new Date(e.createdAt).toLocaleDateString()}</small>
    `}showError(e){document.getElementById("story-detail").innerHTML=`<p style="color: red;">${e}</p>`}renderSaveButton(){document.getElementById("save-actions-container").innerHTML=`
      <button id="save-btn">Simpan Cerita</button>
    `,document.getElementById("save-btn").addEventListener("click",async()=>{await i(this,f).saveStory(),await i(this,f).checkSavedStatus()})}renderRemoveButton(){document.getElementById("save-actions-container").innerHTML=`
      <button id="remove-btn">Hapus Cerita</button>
    `,document.getElementById("remove-btn").addEventListener("click",async()=>{await i(this,f).removeStory(),await i(this,f).checkSavedStatus()})}}q=new WeakMap,f=new WeakMap;const et="modulepreload",tt=function(n){return"/cerita-app/"+n},de={},ue=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),u=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(t.map(d=>{if(d=tt(d),d in de)return;de[d]=!0;const h=d.endsWith(".css"),Le=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${Le}`))return;const b=document.createElement("link");if(b.rel=h?"stylesheet":et,h||(b.as="script"),b.crossOrigin="",b.href=d,u&&b.setAttribute("nonce",u),document.head.appendChild(b),h)return new Promise((Ie,Be)=>{b.addEventListener("load",Ie),b.addEventListener("error",()=>Be(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=s,window.dispatchEvent(u),!u.defaultPrevented)throw s}return o.then(s=>{for(const u of s||[])u.status==="rejected"&&a(u.reason);return e().catch(a)})};var F;class nt{constructor(){c(this,F)}async render(){return`
      <section class="container">
        <h1>Cerita Tersimpan</h1>
        <div id="bookmark-list">Memuat cerita tersimpan...</div>
      </section>
    `}async afterRender(){const{default:e}=await ue(async()=>{const{default:r}=await import("./bookmark-presenter-52f5A_v2.js");return{default:r}},[]),{default:t}=await ue(async()=>{const{default:r}=await Promise.resolve().then(()=>Xe);return{default:r}},void 0);l(this,F,new e({view:this,model:t})),await i(this,F).showSavedStories()}showBookmarkedStories(e){const t=document.getElementById("bookmark-list");if(e.length===0){t.innerHTML="<p>Belum ada cerita yang disimpan.</p>";return}const r=e.map(o=>`
      <a href="#/detail/${o.id}" class="story-item" style="text-decoration: none; color: inherit;">
        <img src="${o.photoUrl}" alt="Foto oleh ${o.name}" class="story-image" />
        <h2>${o.name}</h2>
        <p>${o.description}</p>
        <small>Dibuat pada: ${new Date(o.createdAt).toLocaleDateString()}</small>
      </a>
    `).join("");t.innerHTML=`
      <div class="story-list">
        ${r}
      </div>
    `}showError(e){const t=document.getElementById("bookmark-list");t.innerHTML=`<p style="color: red;">${e}</p>`}}F=new WeakMap;const rt={"/":new De,"/about":new Ce,"/register":new _e,"/login":new Ae,"/add":new Re,"/detail/:id":new Ze,"/bookmark":new nt};function ot(n){const e=n.split("/");return{resource:e[1]||null,id:e[2]||null}}function it(n){let e="";return n.resource&&(e=e.concat(`/${n.resource}`)),n.id&&(e=e.concat("/:id")),e||"/"}function at(){return location.hash.replace("#","")||"/"}function st(){const n=at(),e=ot(n);return it(e)}var O,R,w,k,z,ke;class ct{constructor({navigationDrawer:e,drawerButton:t,content:r}){c(this,z);c(this,O,null);c(this,R,null);c(this,w,null);c(this,k,null);l(this,O,r),l(this,R,t),l(this,w,e),x(this,z,ke).call(this)}async renderPage(){const e=st(),t=rt[e];i(this,k)&&typeof i(this,k).unmount=="function"&&i(this,k).unmount(),document.startViewTransition?await document.startViewTransition(async()=>{i(this,O).innerHTML=await t.render(),await t.afterRender()}):(i(this,O).innerHTML=await t.render(),await t.afterRender()),l(this,k,t)}}O=new WeakMap,R=new WeakMap,w=new WeakMap,k=new WeakMap,z=new WeakSet,ke=function(){i(this,R).addEventListener("click",()=>{i(this,w).classList.toggle("open")}),document.body.addEventListener("click",e=>{!i(this,w).contains(e.target)&&!i(this,R).contains(e.target)&&i(this,w).classList.remove("open"),i(this,w).querySelectorAll("a").forEach(t=>{t.contains(e.target)&&i(this,w).classList.remove("open")})})};function lt(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/-/g,"+").replace(/_/g,"/"),r=atob(t);return new Uint8Array([...r].map(o=>o.charCodeAt(0)))}async function dt(){if("serviceWorker"in navigator)try{await navigator.serviceWorker.register("/sw.js"),console.log("✅ Service worker berhasil terdaftar")}catch(n){console.error("❌ Gagal registrasi service worker:",n)}}async function me(){return!!await(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function ut(n){if(await Notification.requestPermission()!=="granted"){alert("❌ Izin notifikasi tidak diberikan.");return}const r=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:lt(P.VAPID_PUBLIC_KEY)}),{endpoint:o,keys:a}=r.toJSON();await fe({endpoint:o,keys:a},n),alert("✅ Notifikasi berhasil diaktifkan.")}async function mt(n){const t=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(!t){alert("ℹ️ Anda belum berlangganan notifikasi.");return}const{endpoint:r}=t;await we({endpoint:r},n),await t.unsubscribe(),alert("🔕 Notifikasi berhasil dinonaktifkan.")}function re(){const n=localStorage.getItem("authToken"),e=document.querySelector("#nav-list");if(!e)return;e.innerHTML="",n?e.innerHTML=`
      <li><a href="#/">Beranda</a></li>
      <li><a href="#/about">About</a></li>
      <li><a href="#/add">Tambah Cerita</a></li>
      <li><a href="#/bookmark">Cerita Tersimpan</a></li>
      <li><button id="push-btn" class="nav-button">Cek Notifikasi...</button></li>
      <li><a href="#" id="logout-link">Keluar</a></li>
    `:e.innerHTML=`
      <li><a href="#/login">Masuk</a></li>
      <li><a href="#/">Beranda</a></li>
      <li><a href="#/about">About</a></li>
    `;const t=document.querySelector("#logout-link");t&&t.addEventListener("click",()=>{localStorage.removeItem("authToken"),location.hash="#/login",re()});const r=document.querySelector("#push-btn");r&&n&&(me().then(o=>{r.textContent=o?"Unsubscribe Notifikasi":"Subscribe Notifikasi"}),r.addEventListener("click",async()=>{await me()?await mt(n):await ut(n),re()}))}window.updateNav=re;document.addEventListener("DOMContentLoaded",async()=>{var r;const n=localStorage.getItem("authToken"),e=location.hash==="#/login";if(!n&&!e){location.hash="#/login";return}const t=new ct({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});window.updateNav(),await t.renderPage(),(r=document.querySelector(".skip-link"))==null||r.addEventListener("click",o=>{var a;o.preventDefault(),(a=document.querySelector("#main-content"))==null||a.focus()}),window.addEventListener("hashchange",async()=>{if(!localStorage.getItem("authToken")&&!["#/login","#/register"].includes(location.hash)){location.hash="#/login";return}await t.renderPage(),window.updateNav()}),await dt()});
