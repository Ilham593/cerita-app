var re=n=>{throw TypeError(n)};var W=(n,e,t)=>e.has(n)||re("Cannot "+t);var s=(n,e,t)=>(W(n,e,"read from private field"),t?t.call(n):e.get(n)),c=(n,e,t)=>e.has(n)?re("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),l=(n,e,t,r)=>(W(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),$=(n,e,t)=>(W(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const E={BASE_URL:"https://story-api.dicoding.dev/v1",VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk"},H={GET_ALL_STORIES:`${E.BASE_URL}/stories?location=1`,LOGIN:`${E.BASE_URL}/login`,REGISTER:`${E.BASE_URL}/register`,SUBSCRIBE:`${E.BASE_URL}/notifications/subscribe`};async function me(n){return(await(await fetch(H.GET_ALL_STORIES,{headers:{Authorization:`Bearer ${n}`}})).json()).listStory}async function he(n,e){const r=await(await fetch(H.LOGIN,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e})})).json();if(r.error)throw new Error(r.message);return r}async function ge(n,e,t){const o=await(await fetch(H.REGISTER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:e,password:t})})).json();if(o.error)throw new Error(o.message);return o}async function pe(n,e){const t=await fetch(`${E.BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:e}),r=await t.json();if(!t.ok)throw new Error(r.message||"Gagal mengirim cerita.");return r}async function ye({endpoint:n,keys:e},t){const r=await fetch(H.SUBSCRIBE,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({endpoint:n,keys:e})}),o=await r.json();if(!r.ok)throw new Error(o.message||"Gagal berlangganan notifikasi");return o}async function fe({endpoint:n},e){const t=await fetch(H.SUBSCRIBE,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({endpoint:n})}),r=await t.json();if(!t.ok)throw new Error(r.message||"Gagal berhenti langganan notifikasi");return r}async function Be(n,e){const t=await fetch(`${E.BASE_URL}/stories/${e}`,{headers:{Authorization:`Bearer ${n}`}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Gagal mengambil detail cerita.");return r.story}const Pe=Object.freeze(Object.defineProperty({__proto__:null,addNewStory:pe,getAllStories:me,getStoryById:Be,loginUser:he,registerUser:ge,subscribePushNotification:ye,unsubscribePushNotification:fe},Symbol.toStringTag,{value:"Module"}));var y;class Te{constructor({view:e}){c(this,y);l(this,y,e)}async showStories(){const e=localStorage.getItem("authToken");if(!e){s(this,y).showLoginRequired();return}try{const t=await me(e);if(!t||!Array.isArray(t)||t.length===0){s(this,y).showEmptyState();return}s(this,y).showStoriesOnList(t),s(this,y).showStoriesOnMap(t)}catch(t){console.error("Gagal mengambil cerita:",t),s(this,y).showErrorState()}}}y=new WeakMap;var j;class Me{constructor(){c(this,j)}async render(){return`
      <section class="container">
        <h1>Beranda Cerita</h1>
        <div id="story-list" class="story-list">Memuat cerita...</div>

        <h2 style="margin-top: 40px;">Peta Cerita</h2>
        <div id="map" style="height: 400px; margin-top: 16px; border-radius: 8px;"></div>
      </section>
    `}async afterRender(){l(this,j,new Te({view:this})),await s(this,j).showStories()}showStoriesOnList(e){const t=document.querySelector("#story-list");t.innerHTML=e.map(r=>`
      <a href="#/detail/${r.id}" class="story-item" style="text-decoration: none; color: inherit;">
        <img src="${r.photoUrl}" alt="Foto cerita oleh ${r.name}" class="story-image" />
        <h2>${r.name}</h2>
        <p>${r.description}</p>
        <small>Dibuat pada: ${new Date(r.createdAt).toLocaleDateString()}</small>
      </a>
    `).join("")}showStoriesOnMap(e){const t=document.getElementById("map");t._leaflet_id&&(t._leaflet_id=null,t.innerHTML="");const r=L.map("map").setView([-2.5489,118.0149],4);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(r),e.forEach(o=>{o.lat&&o.lon&&L.marker([o.lat,o.lon]).addTo(r).bindPopup(`<strong>${o.name}</strong><br>${o.description}`)})}showEmptyState(){const e=document.querySelector("#story-list");e.innerHTML="<p>Tidak ada cerita ditemukan.</p>"}showErrorState(){const e=document.querySelector("#story-list");e.innerHTML="<p>Gagal memuat cerita. Silakan coba lagi nanti.</p>"}showLoginRequired(){const e=document.querySelector("#story-list");e.innerHTML='<p>Anda belum login. Silakan <a href="#/login">login</a> terlebih dahulu.</p>'}}j=new WeakMap;class Ce{async render(){return`
      <section class="container">
        <h1>About Page</h1>
      </section>
    `}async afterRender(){}}var C;class De{constructor(e){c(this,C);l(this,C,e)}async login(e,t){try{const r=await he(e,t);localStorage.setItem("authToken",r.loginResult.token),s(this,C).showSuccessMessage("Login berhasil!"),setTimeout(()=>{var o;(o=window.updateNav)==null||o.call(window),location.hash="#/"},1e3)}catch(r){s(this,C).showErrorMessage(r.message)}}}C=new WeakMap;var U;class Ae{constructor(){c(this,U)}async render(){return`
      <section class="container">
        <h1>Login</h1>
        <form id="login-form">
          <label for="email">Email</label>
          <input type="email" id="email" required />

          <label for="password">Password</label>
          <input type="password" id="password" required minlength="8" />

          <button type="submit">Masuk</button>
        </form>
        <div id="login-message"></div>
        <p style="margin-top: 10px;">Belum punya akun? <a href="#/register">Daftar di sini</a>.</p>
      </section>
    `}async afterRender(){l(this,U,new De(this));const e=document.querySelector("#login-form");e.addEventListener("submit",t=>{t.preventDefault();const r=e.email.value,o=e.password.value;s(this,U).login(r,o)})}showSuccessMessage(e){const t=document.getElementById("login-message");t.style.color="green",t.textContent=e}showErrorMessage(e){const t=document.getElementById("login-message");t.style.color="red",t.textContent="Login gagal: "+e}}U=new WeakMap;var m,D,A,g,x,T,we,Y;class xe{constructor({view:e}){c(this,T);c(this,m);c(this,D,null);c(this,A,null);c(this,g,null);c(this,x,null);l(this,m,e)}async initialize(){if(l(this,D,localStorage.getItem("authToken")),!s(this,D)){s(this,m).showLoginRequired();return}$(this,T,we).call(this),await $(this,T,Y).call(this)}capturePhoto(){const{canvas:e,ctx:t}=s(this,m).getCanvasContext(),r=document.getElementById("camera-video");e.width=r.videoWidth,e.height=r.videoHeight,t.drawImage(r,0,0),e.toBlob(o=>{if(!o){s(this,m).showMessage("Gagal menangkap gambar.","error");return}l(this,A,o);const a=URL.createObjectURL(o);s(this,m).showCapturedImage(a),s(this,g)&&s(this,g).getTracks().forEach(i=>i.stop())},"image/jpeg")}async submitForm(e,t,r){if(!s(this,A)||!e){s(this,m).showMessage("Foto dan deskripsi wajib diisi.","error");return}const o=new File([s(this,A)],"snapshot.jpg",{type:"image/jpeg"}),a=new FormData;a.append("description",e),a.append("photo",o),t&&r&&(a.append("lat",t),a.append("lon",r));try{const i=await pe(s(this,D),a);s(this,m).showMessage(i.message||"Cerita berhasil dikirim!"),s(this,m).resetFormUI(),setTimeout(()=>{location.hash="#/"},1e3)}catch(i){console.error(i),s(this,m).showMessage(i.message||"Gagal mengirim cerita.","error")}}async restartCamera(){s(this,g)&&s(this,g).getTracks().forEach(e=>e.stop()),await $(this,T,Y).call(this)}destroy(){s(this,g)&&(s(this,g).getTracks().forEach(e=>e.stop()),l(this,g,null))}}m=new WeakMap,D=new WeakMap,A=new WeakMap,g=new WeakMap,x=new WeakMap,T=new WeakSet,we=function(){const e=L.map(s(this,m).getMapContainer()).setView([-2.5,118],4);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(e);const t=L.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34]});e.on("click",r=>{const{lat:o,lng:a}=r.latlng;s(this,m).setLatLon(o,a),s(this,x)&&s(this,x).remove(),l(this,x,L.marker([o,a],{icon:t}).addTo(e).bindPopup(`<strong>Lokasi dipilih:</strong><br>${o.toFixed(5)}, ${a.toFixed(5)}`).openPopup())})},Y=async function(){try{l(this,g,await navigator.mediaDevices.getUserMedia({video:!0})),s(this,m).setVideoStream(s(this,g))}catch(e){console.error("Tidak dapat mengakses kamera:",e),s(this,m).showMessage("Tidak dapat mengakses kamera.","error")}};var f;class Re{constructor(){c(this,f)}async render(){return`
      <section class="container">
        <h1>Tambah Cerita Baru</h1>

        <form id="add-story-form">
          <label for="description">Deskripsi</label>
          <textarea id="description" rows="4" required></textarea>

          <label>Ambil Foto dari Kamera</label>
          <video id="camera-video" autoplay playsinline style="width: 100%; max-width: 400px; border-radius: 8px;"></video>
          <p style="font-size: 0.9rem; color: #555; margin-top: 6px;">Cukup 1 klik untuk ambil foto.</p>
          <button type="button" id="capture-btn">Ambil Foto</button>
          <button type="button" id="retake-btn">Ambil Ulang Foto</button>

          <canvas id="snapshot-canvas" style="display: none;"></canvas>
          <img id="preview-image" style="display: none; width: 100%; margin-top: 1rem; border-radius: 8px;" />

          <label>Lokasi</label>
          <div id="map" style="height: 300px; margin-bottom: 1rem;"></div>
          <input type="hidden" id="lat" />
          <input type="hidden" id="lon" />

          <button type="submit">Kirim Cerita</button>
        </form>

        <div id="submit-message"></div>
      </section>
    `}async afterRender(){var e,t,r;l(this,f,new xe({view:this})),await s(this,f).initialize(),(e=document.getElementById("capture-btn"))==null||e.addEventListener("click",()=>s(this,f).capturePhoto()),(t=document.getElementById("retake-btn"))==null||t.addEventListener("click",()=>s(this,f).restartCamera()),(r=document.getElementById("add-story-form"))==null||r.addEventListener("submit",o=>{o.preventDefault();const a=document.getElementById("description").value,i=document.getElementById("lat").value,u=document.getElementById("lon").value;s(this,f).submitForm(a,i,u)})}unmount(){var e;(e=s(this,f))==null||e.destroy()}setVideoStream(e){const t=document.getElementById("camera-video");t.srcObject=e}showCapturedImage(e){const t=document.getElementById("preview-image");t.src=e,t.style.display="block"}getCanvasContext(){const e=document.getElementById("snapshot-canvas"),t=e.getContext("2d");return{canvas:e,ctx:t}}resetFormUI(){const e=document.getElementById("add-story-form"),t=document.getElementById("preview-image");e.reset(),t.src="",t.style.display="none",document.getElementById("lat").value="",document.getElementById("lon").value=""}showMessage(e,t="success"){const r=document.getElementById("submit-message");r.style.color=t==="success"?"green":"red",r.textContent=e}setLatLon(e,t){document.getElementById("lat").value=e,document.getElementById("lon").value=t}getMapContainer(){return document.getElementById("map")}showLoginRequired(){const e=document.querySelector(".container");e.innerHTML='<p>Anda belum login. Silakan <a href="#/login">login</a> terlebih dahulu.</p>'}}f=new WeakMap;var k;class Oe{constructor(e){c(this,k);l(this,k,e)}async register(e,t,r){try{await ge(e,t,r),s(this,k).showSuccessMessage("Registrasi berhasil! Silakan login."),setTimeout(()=>s(this,k).redirectToLogin(),1e3)}catch(o){s(this,k).showErrorMessage(o.message)}}}k=new WeakMap;var N;class _e{constructor(){c(this,N)}async render(){return`
      <section class="container">
        <h1>Register</h1>
        <form id="register-form">
          <label for="name">Nama</label>
          <input type="text" id="name" required />

          <label for="email">Email</label>
          <input type="email" id="email" required />

          <label for="password">Password</label>
          <input type="password" id="password" required minlength="8" />

          <button type="submit">Daftar</button>
        </form>
        <div id="register-message"></div>
      </section>
    `}async afterRender(){l(this,N,new Oe(this));const e=document.querySelector("#register-form");e.addEventListener("submit",t=>{t.preventDefault();const r=e.name.value,o=e.email.value,a=e.password.value;s(this,N).register(r,o,a)})}showSuccessMessage(e){const t=document.getElementById("register-message");t.style.color="green",t.textContent=e}showErrorMessage(e){const t=document.getElementById("register-message");t.style.color="red",t.textContent="Gagal daftar: "+e}redirectToLogin(){location.hash="#/login"}}N=new WeakMap;var S,p,R,I;class $e{constructor(e,{view:t,apiModel:r,dbModel:o}){c(this,S);c(this,p);c(this,R);c(this,I);l(this,S,e),l(this,p,t),l(this,R,r),l(this,I,o)}async init(){const e=localStorage.getItem("authToken");if(!e){s(this,p).showError("Anda harus login terlebih dahulu.");return}try{const t=await s(this,R).getStoryById(e,s(this,S));s(this,p).showStoryDetail(t),await this.checkSavedStatus()}catch(t){console.error("Gagal mengambil detail:",t),s(this,p).showError(t.message||"Terjadi kesalahan saat mengambil data.")}}async checkSavedStatus(){await s(this,I).getStoryById(s(this,S))?s(this,p).renderRemoveButton():s(this,p).renderSaveButton()}async saveStory(){const e=localStorage.getItem("authToken");if(!e){s(this,p).showError("Anda harus login untuk menyimpan cerita.");return}try{const t=await s(this,R).getStoryById(e,s(this,S));await s(this,I).putStory(t),console.log("Cerita berhasil disimpan!")}catch(t){console.error("saveStory error:",t),s(this,p).showError("Gagal menyimpan cerita.")}}async removeStory(){try{await s(this,I).removeStory(s(this,S)),console.log("Cerita berhasil dihapus!")}catch(e){console.error("removeStory error:",e),s(this,p).showError("Gagal menghapus cerita.")}}}S=new WeakMap,p=new WeakMap,R=new WeakMap,I=new WeakMap;const Q=(n,e)=>e.some(t=>n instanceof t);let oe,se;function je(){return oe||(oe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ue(){return se||(se=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const X=new WeakMap,K=new WeakMap,z=new WeakMap;function Ne(n){const e=new Promise((t,r)=>{const o=()=>{n.removeEventListener("success",a),n.removeEventListener("error",i)},a=()=>{t(P(n.result)),o()},i=()=>{r(n.error),o()};n.addEventListener("success",a),n.addEventListener("error",i)});return z.set(e,n),e}function qe(n){if(X.has(n))return;const e=new Promise((t,r)=>{const o=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",i),n.removeEventListener("abort",i)},a=()=>{t(),o()},i=()=>{r(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",a),n.addEventListener("error",i),n.addEventListener("abort",i)});X.set(n,e)}let Z={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return X.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return P(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function be(n){Z=n(Z)}function Fe(n){return Ue().includes(n)?function(...e){return n.apply(ee(this),e),P(this.request)}:function(...e){return P(n.apply(ee(this),e))}}function He(n){return typeof n=="function"?Fe(n):(n instanceof IDBTransaction&&qe(n),Q(n,je())?new Proxy(n,Z):n)}function P(n){if(n instanceof IDBRequest)return Ne(n);if(K.has(n))return K.get(n);const e=He(n);return e!==n&&(K.set(n,e),z.set(e,n)),e}const ee=n=>z.get(n);function Ge(n,e,{blocked:t,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(n,e),u=P(i);return r&&i.addEventListener("upgradeneeded",d=>{r(P(i.result),d.oldVersion,d.newVersion,P(i.transaction),d)}),t&&i.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{a&&d.addEventListener("close",()=>a()),o&&d.addEventListener("versionchange",h=>o(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}const Ve=["get","getKey","getAll","getAllKeys","count"],ze=["put","add","delete","clear"],J=new Map;function ie(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(J.get(e))return J.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,o=ze.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(o||Ve.includes(t)))return;const a=async function(i,...u){const d=this.transaction(i,o?"readwrite":"readonly");let h=d.store;return r&&(h=h.index(u.shift())),(await Promise.all([h[t](...u),o&&d.done]))[0]};return J.set(e,a),a}be(n=>({...n,get:(e,t,r)=>ie(e,t)||n.get(e,t,r),has:(e,t)=>!!ie(e,t)||n.has(e,t)}));const We=["continue","continuePrimaryKey","advance"],ae={},te=new WeakMap,ve=new WeakMap,Ke={get(n,e){if(!We.includes(e))return n[e];let t=ae[e];return t||(t=ae[e]=function(...r){te.set(this,ve.get(this)[e](...r))}),t}};async function*Je(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const t=new Proxy(e,Ke);for(ve.set(t,e),z.set(t,ee(e));e;)yield t,e=await(te.get(t)||e.continue()),te.delete(t)}function ce(n,e){return e===Symbol.asyncIterator&&Q(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Q(n,[IDBIndex,IDBObjectStore])}be(n=>({...n,get(e,t,r){return ce(e,t)?Je:n.get(e,t,r)},has(e,t){return ce(e,t)||n.has(e,t)}}));const Ye="story-app-db",Qe=1,M="stories",G=Ge(Ye,Qe,{upgrade(n){n.objectStoreNames.contains(M)||n.createObjectStore(M,{keyPath:"id"})}}),Se={async putStory(n){if(!n.id)throw new Error("Cerita harus memiliki id");return(await G).put(M,n)},async getStoryById(n){return(await G).get(M,n)},async getAllStories(){return(await G).getAll(M)},async removeStory(n){return(await G).delete(M,n)}},Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));var q,w;class Ze{constructor(){c(this,q);c(this,w)}async render(){return`
      <section class="container">
        <div id="story-detail">Memuat cerita...</div>
        <div id="save-actions-container" style="margin-top: 16px;"></div>
      </section>
    `}async afterRender(){l(this,q,window.location.hash.split("/")[2]),l(this,w,new $e(s(this,q),{view:this,apiModel:Pe,dbModel:Se})),await s(this,w).init()}showStoryDetail(e){const t=document.getElementById("story-detail");t.innerHTML=`
      <img src="${e.photoUrl}" alt="Foto oleh ${e.name}" style="width: 100%; border-radius: 8px;" />
      <h2>${e.name}</h2>
      <p>${e.description}</p>
      <small>Dibuat pada: ${new Date(e.createdAt).toLocaleDateString()}</small>
    `}showError(e){document.getElementById("story-detail").innerHTML=`<p style="color: red;">${e}</p>`}renderSaveButton(){document.getElementById("save-actions-container").innerHTML=`
      <button id="save-btn">Simpan Cerita</button>
    `,document.getElementById("save-btn").addEventListener("click",async()=>{await s(this,w).saveStory(),await s(this,w).checkSavedStatus()})}renderRemoveButton(){document.getElementById("save-actions-container").innerHTML=`
      <button id="remove-btn">Hapus Cerita</button>
    `,document.getElementById("remove-btn").addEventListener("click",async()=>{await s(this,w).removeStory(),await s(this,w).checkSavedStatus()})}}q=new WeakMap,w=new WeakMap;const et="modulepreload",tt=function(n){return"/cerita-app/"+n},le={},de=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),u=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(t.map(d=>{if(d=tt(d),d in le)return;le[d]=!0;const h=d.endsWith(".css"),ke=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${ke}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":et,h||(v.as="script"),v.crossOrigin="",v.href=d,u&&v.setAttribute("nonce",u),document.head.appendChild(v),h)return new Promise((Le,Ie)=>{v.addEventListener("load",Le),v.addEventListener("error",()=>Ie(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(i){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i}return o.then(i=>{for(const u of i||[])u.status==="rejected"&&a(u.reason);return e().catch(a)})};var F;class nt{constructor(){c(this,F)}async render(){return`
      <section class="container">
        <h1>Cerita Tersimpan</h1>
        <div id="bookmark-list">Memuat cerita tersimpan...</div>
      </section>
    `}async afterRender(){const{default:e}=await de(async()=>{const{default:r}=await import("./bookmark-presenter-52f5A_v2.js");return{default:r}},[]),{default:t}=await de(async()=>{const{default:r}=await Promise.resolve().then(()=>Xe);return{default:r}},void 0);l(this,F,new e({view:this,model:t})),await s(this,F).showSavedStories()}showBookmarkedStories(e){const t=document.getElementById("bookmark-list");if(e.length===0){t.innerHTML="<p>Belum ada cerita yang disimpan.</p>";return}const r=e.map(o=>`
      <a href="#/detail/${o.id}" class="story-item" style="text-decoration: none; color: inherit;">
        <img src="${o.photoUrl}" alt="Foto oleh ${o.name}" class="story-image" />
        <h2>${o.name}</h2>
        <p>${o.description}</p>
        <small>Dibuat pada: ${new Date(o.createdAt).toLocaleDateString()}</small>
      </a>
    `).join("");t.innerHTML=`
      <div class="story-list">
        ${r}
      </div>
    `}showError(e){const t=document.getElementById("bookmark-list");t.innerHTML=`<p style="color: red;">${e}</p>`}}F=new WeakMap;const rt={"/":new Me,"/about":new Ce,"/register":new _e,"/login":new Ae,"/add":new Re,"/detail/:id":new Ze,"/bookmark":new nt};function ot(n){const e=n.split("/");return{resource:e[1]||null,id:e[2]||null}}function st(n){let e="";return n.resource&&(e=e.concat(`/${n.resource}`)),n.id&&(e=e.concat("/:id")),e||"/"}function it(){return location.hash.replace("#","")||"/"}function at(){const n=it(),e=ot(n);return st(e)}var O,_,b,B,V,Ee;class ct{constructor({navigationDrawer:e,drawerButton:t,content:r}){c(this,V);c(this,O,null);c(this,_,null);c(this,b,null);c(this,B,null);l(this,O,r),l(this,_,t),l(this,b,e),$(this,V,Ee).call(this)}async renderPage(){const e=at(),t=rt[e];s(this,B)&&typeof s(this,B).unmount=="function"&&s(this,B).unmount(),document.startViewTransition?await document.startViewTransition(async()=>{s(this,O).innerHTML=await t.render(),await t.afterRender()}):(s(this,O).innerHTML=await t.render(),await t.afterRender()),l(this,B,t)}}O=new WeakMap,_=new WeakMap,b=new WeakMap,B=new WeakMap,V=new WeakSet,Ee=function(){s(this,_).addEventListener("click",()=>{s(this,b).classList.toggle("open")}),document.body.addEventListener("click",e=>{!s(this,b).contains(e.target)&&!s(this,_).contains(e.target)&&s(this,b).classList.remove("open"),s(this,b).querySelectorAll("a").forEach(t=>{t.contains(e.target)&&s(this,b).classList.remove("open")})})};function lt(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/-/g,"+").replace(/_/g,"/"),r=atob(t);return new Uint8Array([...r].map(o=>o.charCodeAt(0)))}async function ue(){return!!await(await navigator.serviceWorker.ready).pushManager.getSubscription()}async function dt(n){if(await Notification.requestPermission()!=="granted"){alert("❌ Izin notifikasi tidak diberikan.");return}const r=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:lt(E.VAPID_PUBLIC_KEY)}),{endpoint:o,keys:a}=r.toJSON();await ye({endpoint:o,keys:a},n),alert("✅ Notifikasi berhasil diaktifkan.")}async function ut(n){const t=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(!t){alert("ℹ️ Anda belum berlangganan notifikasi.");return}const{endpoint:r}=t;await fe({endpoint:r},n),await t.unsubscribe(),alert("🔕 Notifikasi berhasil dinonaktifkan.")}function ne(){const n=localStorage.getItem("authToken"),e=document.querySelector("#nav-list");if(!e)return;e.innerHTML="",n?e.innerHTML=`
      <li><a href="#/">Beranda</a></li>
      <li><a href="#/about">About</a></li>
      <li><a href="#/add">Tambah Cerita</a></li>
      <li><a href="#/bookmark">Cerita Tersimpan</a></li>
      <li><button id="push-btn" class="nav-button">Cek Notifikasi...</button></li>
      <li><a href="#" id="logout-link">Keluar</a></li>
    `:e.innerHTML=`
      <li><a href="#/login">Masuk</a></li>
      <li><a href="#/">Beranda</a></li>
      <li><a href="#/about">About</a></li>
    `;const t=document.querySelector("#logout-link");t&&t.addEventListener("click",()=>{localStorage.removeItem("authToken"),location.hash="#/login",ne()});const r=document.querySelector("#push-btn");r&&n&&(ue().then(o=>{r.textContent=o?"Unsubscribe Notifikasi":"Subscribe Notifikasi"}),r.addEventListener("click",async()=>{await ue()?await ut(n):await dt(n),ne()}))}window.updateNav=ne;document.addEventListener("DOMContentLoaded",async()=>{var o;const n=localStorage.getItem("authToken"),e=location.hash==="#/login";if(!n&&!e){location.hash="#/login";return}const t=new ct({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});window.updateNav(),await t.renderPage(),(o=document.querySelector(".skip-link"))==null||o.addEventListener("click",a=>{var i;a.preventDefault(),(i=document.querySelector("#main-content"))==null||i.focus()}),window.addEventListener("hashchange",async()=>{if(!localStorage.getItem("authToken")&&!["#/login","#/register"].includes(location.hash)){location.hash="#/login";return}await t.renderPage(),window.updateNav()}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/cerita-app/sw.js").then(()=>console.log(" Service worker berhasil terdaftar")).catch(a=>console.error("gagal registrasi service worker:",a))});let r;window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),r=a;const i=document.createElement("button");i.textContent="Install Aplikasi",i.id="install-btn",i.style.position="fixed",i.style.bottom="1rem",i.style.right="1rem",i.style.zIndex="999",i.style.padding="1rem",i.style.backgroundColor="#ff9800",i.style.color="#fff",i.style.border="none",i.style.borderRadius="8px",i.style.cursor="pointer",document.body.appendChild(i),i.addEventListener("click",async()=>{r.prompt();const{outcome:u}=await r.userChoice;console.log(`User response to the install prompt: ${u}`),r=null,i.remove()})})});
